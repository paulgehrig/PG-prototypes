<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spoke Navigation Hub Loop - EMMY Prototype</title>
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;700&family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* ============================================
           RESET & BASE
           ============================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Source Sans Pro', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: white;
            line-height: 1.5;
            color: #1b1b1b;
            font-size: 16px;
        }

        /* ============================================
           GOVERNMENT BANNER + EMMY HEADER (shared)
           ============================================ */
        .gov-banner {
            background: #162e51;
        }

        .gov-banner-inner {
            max-width: 640px;
            margin: 0 auto;
            padding: 8px 16px;
        }

        .gov-banner-text {
            font-size: 12px;
            color: white;
        }

        .emmy-header {
            border-bottom: 1px solid #dfe1e2;
            background: white;
        }

        .emmy-header-inner {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 640px;
            margin: 0 auto;
            padding: 0 16px;
        }

        .emmy-header-title {
            padding: 12px 0;
            font-size: 14px;
            font-weight: 700;
            color: #1b1b1b;
        }

        .emmy-header-menu {
            background: #005ea2;
            color: white;
            padding: 14px 12px;
            font-size: 13px;
            text-transform: uppercase;
            font-weight: 400;
            border: none;
            cursor: pointer;
        }

        /* ============================================
           FOOTER (shared)
           ============================================ */
        .site-footer {
            background: #162e51;
            margin-top: 32px;
        }

        .site-footer-inner {
            max-width: 640px;
            margin: 0 auto;
            padding: 20px 16px;
        }

        .site-footer-title {
            font-family: 'Public Sans', sans-serif;
            font-size: 20px;
            font-weight: 700;
            color: white;
            margin-bottom: 16px;
            line-height: 1.15;
        }

        .site-footer-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border: 2px solid #e6e6e6;
            border-radius: 4px;
            background: transparent;
            color: #e6e6e6;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
        }

        /* ============================================
           CONTAINER
           ============================================ */
        .container {
            max-width: 640px;
            margin: 0 auto;
            padding: 0 16px;
        }

        /* ============================================
           VIEW TOGGLE (only one visible at a time)
           ============================================ */
        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        /* ============================================
           HUB VIEW
           ============================================ */
        .hub-content {
            padding: 24px 0 40px;
        }

        .hub-title {
            font-family: 'Public Sans', sans-serif;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #1b1b1b;
            line-height: 1.15;
        }

        .hub-period {
            font-size: 16px;
            color: #1b1b1b;
            margin-bottom: 24px;
        }

        .hub-period strong {
            font-weight: 700;
        }

        /* Success banner */
        .success-banner {
            display: none;
            padding: 12px 16px;
            background: #ecf3ec;
            border-left: 4px solid #00a91c;
            margin-bottom: 24px;
            font-size: 16px;
            font-weight: 600;
            color: #1b1b1b;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Progress section */
        .progress-section {
            margin-bottom: 32px;
        }

        .progress-section h2 {
            font-family: 'Public Sans', sans-serif;
            font-size: 20px;
            font-weight: 700;
            color: #1b1b1b;
            margin-bottom: 4px;
        }

        .progress-section-desc {
            font-size: 16px;
            color: #1b1b1b;
            margin-bottom: 12px;
        }

        .months-completed-counter {
            font-size: 16px;
            font-weight: 700;
            color: #1b1b1b;
            margin-bottom: 16px;
        }

        .month-progress-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .month-progress-row {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .month-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .month-progress-label {
            font-size: 14px;
            font-weight: 400;
            color: #1b1b1b;
        }

        .month-progress-hours {
            font-size: 14px;
            color: #1b1b1b;
        }

        .month-progress-bar {
            height: 8px;
            background: #d9e8f6;
            border: 1px solid #0050d8;
            border-radius: 4px;
            overflow: hidden;
        }

        .month-progress-bar-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.4s ease;
            background: #005ea2;
        }

        .submit-cta {
            display: block;
            width: 100%;
            padding: 14px 24px;
            background: #005ea2;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 700;
            font-family: inherit;
            cursor: pointer;
            text-align: center;
            margin-top: 20px;
        }

        .submit-cta:hover {
            background: #1a4480;
        }

        /* Category sections */
        .category-section {
            margin-bottom: 32px;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .category-title {
            font-family: 'Public Sans', sans-serif;
            font-size: 24px;
            font-weight: 700;
            color: #1b1b1b;
        }

        .category-add-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border: 2px solid #005ea2;
            border-radius: 4px;
            background: transparent;
            color: #005ea2;
            font-size: 14px;
            font-weight: 700;
            font-family: inherit;
            cursor: pointer;
            transition: background 0.15s ease;
        }

        .category-add-btn:hover:not(:disabled) {
            background: #f0f7ff;
        }

        .category-add-btn:disabled {
            border-color: #a9aeb1;
            color: #a9aeb1;
            cursor: not-allowed;
        }

        .category-add-btn svg {
            width: 18px;
            height: 18px;
        }

        /* Empty state card */
        .category-empty {
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            color: #71767a;
            font-size: 16px;
        }

        /* Activity summary card */
        .activity-card {
            background: white;
            border: 1px solid #dfe1e2;
            border-radius: 8px;
            overflow: hidden;
        }

        .activity-card-header {
            padding: 16px 20px 8px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .activity-card-name {
            font-size: 16px;
            font-weight: 700;
            color: #1b1b1b;
        }

        .activity-card-link {
            color: #005ea2;
            text-decoration: underline;
            font-size: 14px;
            cursor: pointer;
            background: none;
            border: none;
            font-family: inherit;
            padding: 0;
        }

        .activity-card-body {
            padding: 8px 20px 16px;
        }

        .activity-card-stats {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
        }

        .activity-stat {
            display: flex;
            flex-direction: column;
        }

        .activity-stat-label {
            font-size: 12px;
            color: #71767a;
        }

        .activity-stat-value {
            font-size: 14px;
            font-weight: 600;
            color: #1b1b1b;
        }

        /* ============================================
           SPOKE VIEW — CHROME (sticky)
           ============================================ */

        .spoke-chrome {
            position: sticky;
            top: 0;
            z-index: 10;
            background: white;
            border-bottom: 1px solid #dfe1e2;
        }

        /* Row 1: Flow label + Exit (shared by both options) */
        .spoke-chrome-row1 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 640px;
            margin: 0 auto;
            padding: 10px 16px;
        }

        .spoke-flow-label {
            font-family: 'Public Sans', sans-serif;
            font-size: 19px;
            font-weight: 700;
            color: #1b1b1b;
        }

        .spoke-exit-link {
            font-family: 'Public Sans', sans-serif;
            font-size: 16px;
            font-weight: 400;
            color: #005ea2;
            text-decoration: underline;
            cursor: pointer;
            background: none;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        /* ============================================
           STEP INDICATOR (Option 1 only)
           ============================================ */

        .spoke-step-indicator {
            display: none;
            max-width: 640px;
            margin: 0 auto;
            padding: 0 16px 12px;
        }

        body.nav-step-indicator .spoke-step-indicator {
            display: block;
        }

        /* Segmented progress bar */
        .spoke-step-bar {
            display: flex;
            gap: 3px;
            margin-bottom: 12px;
        }

        .spoke-step-segment {
            flex: 1;
            height: 8px;
            border-radius: 4px;
            background: #dfe1e2;
            transition: background 0.3s ease;
        }

        .spoke-step-segment.completed {
            background: #005ea2;
        }

        /* Step counter: circle + text */
        .spoke-step-counter {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .spoke-step-circle {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #005ea2;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Public Sans', sans-serif;
            font-size: 16px;
            font-weight: 700;
            flex-shrink: 0;
        }

        .spoke-step-text {
            font-family: 'Public Sans', sans-serif;
            font-size: 16px;
            color: #005ea2;
        }

        .spoke-step-phase {
            font-family: 'Public Sans', sans-serif;
            font-size: 16px;
            font-weight: 700;
            color: #1b1b1b;
            margin-left: 2px;
        }

        /* ============================================
           SPOKE VIEW — CONTENT
           ============================================ */

        /* Exit warning */
        .exit-warning {
            display: none;
            background: #faf3d1;
            border-left: 4px solid #ffbe2e;
            padding: 16px;
            margin: 16px 0;
        }

        .exit-warning.visible {
            display: block;
        }

        .exit-warning h3 {
            font-family: 'Public Sans', sans-serif;
            font-size: 17px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .exit-warning p {
            font-size: 16px;
            color: #1b1b1b;
            margin-bottom: 12px;
        }

        .exit-warning-actions {
            display: flex;
            gap: 24px;
        }

        .exit-warning-leave {
            color: #b50909;
            font-size: 16px;
            font-weight: 700;
            text-decoration: underline;
            cursor: pointer;
            background: none;
            border: none;
            font-family: inherit;
        }

        .exit-warning-stay {
            color: #005ea2;
            font-size: 16px;
            font-weight: 700;
            text-decoration: underline;
            cursor: pointer;
            background: none;
            border: none;
            font-family: inherit;
        }

        /* Spoke screen content */
        .spoke-content {
            padding: 24px 0 40px;
        }

        /* Back link (simple text link — GOV.UK style) */
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: #005ea2;
            font-family: 'Source Sans Pro', sans-serif;
            font-size: 16px;
            font-weight: 400;
            text-decoration: underline;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            margin-bottom: 20px;
        }

        .back-link:hover {
            color: #1a4480;
        }

        .back-link svg {
            width: 12px;
            height: 12px;
            fill: currentColor;
        }

        /* Month sub-counter */
        .month-sub-counter {
            font-family: 'Public Sans', sans-serif;
            font-size: 17px;
            font-weight: 700;
            color: #005ea2;
            margin-bottom: 8px;
        }

        /* Typography */
        h1 {
            font-family: 'Public Sans', sans-serif;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 16px;
            color: #1b1b1b;
            line-height: 1.15;
        }

        .spoke-content h1 + .form-intro {
            font-size: 16px;
            color: #1b1b1b;
            margin-bottom: 24px;
            line-height: 1.5;
        }

        /* Form elements */
        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-weight: 700;
            margin-bottom: 4px;
            font-size: 16px;
            color: #1b1b1b;
        }

        .form-hint {
            font-size: 16px;
            color: #71767a;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            max-width: 370px;
            padding: 8px;
            border: 1px solid #1b1b1b;
            font-size: 16px;
            font-family: inherit;
            color: #1b1b1b;
            background: white;
            height: 40px;
        }

        .form-input:focus {
            outline: 3px solid #2491ff;
            outline-offset: 0;
        }

        .input-prefix-wrapper {
            position: relative;
            max-width: 370px;
        }

        .input-prefix-wrapper .form-input {
            padding-left: 28px;
        }

        .input-prefix {
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
            color: #1b1b1b;
            font-size: 16px;
            pointer-events: none;
        }

        /* Tile checkbox (USWDS style) */
        .tile-checkbox {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: white;
            border: 2px solid #c9c9c9;
            border-radius: 4px;
            margin-bottom: 24px;
            cursor: pointer;
            transition: all 0.15s ease;
            max-width: 370px;
        }

        .tile-checkbox:hover {
            border-color: #005ea2;
        }

        .tile-checkbox.checked {
            background: #005ea2;
            border-color: #005ea2;
            color: white;
        }

        .tile-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: white;
            flex-shrink: 0;
        }

        .tile-checkbox label {
            font-size: 16px;
            cursor: pointer;
            flex: 1;
        }

        .tile-checkbox.checked label {
            color: white;
        }

        /* Primary button */
        .btn-primary {
            display: block;
            width: 100%;
            padding: 14px 20px;
            background: #005ea2;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 700;
            font-family: inherit;
            cursor: pointer;
            text-align: center;
            margin-top: 32px;
        }

        .btn-primary:hover {
            background: #1a4480;
        }

        /* Document upload area */
        .upload-instructions {
            font-size: 16px;
            color: #1b1b1b;
            margin-bottom: 24px;
            line-height: 1.5;
        }

        .file-upload-area {
            border: 2px dashed #71767a;
            padding: 32px 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.15s ease;
            margin-bottom: 16px;
            border-radius: 4px;
        }

        .file-upload-area:hover {
            border-color: #005ea2;
            background: #f0f7ff;
        }

        .file-upload-area p {
            font-size: 16px;
            color: #71767a;
        }

        .file-upload-area a {
            color: #005ea2;
            text-decoration: underline;
        }

        .file-upload-icon {
            margin-bottom: 8px;
        }

        .file-upload-icon svg {
            width: 32px;
            height: 32px;
            fill: #71767a;
        }

        /* Suggested documents expandable */
        .suggested-docs {
            margin-top: 8px;
        }

        .suggested-docs-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 12px 16px;
            background: #f0f0f0;
            border: none;
            border-radius: 4px;
            font-family: inherit;
            font-size: 16px;
            font-weight: 700;
            color: #1b1b1b;
            cursor: pointer;
        }

        .suggested-docs-toggle svg {
            transition: transform 0.2s ease;
        }

        .suggested-docs-toggle.open svg {
            transform: rotate(45deg);
        }

        .suggested-docs-content {
            display: none;
            padding: 12px 16px;
            background: #f0f0f0;
            border-radius: 0 0 4px 4px;
            font-size: 16px;
            color: #1b1b1b;
        }

        .suggested-docs-content.open {
            display: block;
        }

        .suggested-docs-content ul {
            margin: 8px 0 0 20px;
        }

        .suggested-docs-content li {
            margin-bottom: 4px;
        }

        /* ============================================
           REVIEW SCREEN
           ============================================ */

        .review-intro {
            font-size: 16px;
            color: #1b1b1b;
            margin-bottom: 32px;
            line-height: 1.5;
        }

        .review-section {
            margin-bottom: 32px;
        }

        .review-section-header {
            font-family: 'Public Sans', sans-serif;
            font-size: 17px;
            font-weight: 700;
            color: #1b1b1b;
            padding-bottom: 8px;
            border-bottom: 1px solid #1b1b1b;
            margin-bottom: 16px;
        }

        .review-row {
            margin-bottom: 12px;
        }

        .review-label {
            font-size: 16px;
            font-weight: 700;
            color: #1b1b1b;
            margin-bottom: 2px;
        }

        .review-value {
            font-size: 16px;
            color: #1b1b1b;
        }

        /* Monthly review rows with per-month Edit links */
        .review-month-block {
            border-top: 1px solid #dfe1e2;
            padding-top: 12px;
            margin-top: 12px;
        }

        .review-month-block:first-child {
            border-top: none;
            padding-top: 0;
            margin-top: 0;
        }

        .review-month-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .review-month-name {
            font-size: 16px;
            font-weight: 700;
            color: #1b1b1b;
        }

        .review-month-name.no-data {
            color: #71767a;
        }

        .edit-link {
            color: #005ea2;
            font-size: 14px;
            font-weight: 400;
            text-decoration: underline;
            cursor: pointer;
            background: none;
            border: none;
            font-family: inherit;
            padding: 0;
        }

        .change-link {
            color: #005ea2;
            font-size: 16px;
            font-weight: 400;
            text-decoration: underline;
            cursor: pointer;
            background: none;
            border: none;
            font-family: inherit;
        }

        .review-section-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'Public Sans', sans-serif;
            font-size: 17px;
            font-weight: 700;
            color: #1b1b1b;
            padding-bottom: 8px;
            border-bottom: 1px solid #1b1b1b;
            margin-bottom: 16px;
        }

        .review-month-detail {
            display: flex;
            justify-content: space-between;
            padding: 2px 0;
        }

        .review-month-detail-label {
            font-size: 16px;
            color: #1b1b1b;
        }

        .review-month-detail-value {
            font-size: 16px;
            color: #1b1b1b;
        }

        /* Additional comments */
        .form-textarea {
            width: 100%;
            max-width: 100%;
            min-height: 100px;
            padding: 8px;
            border: 1px solid #1b1b1b;
            font-size: 16px;
            font-family: inherit;
            color: #1b1b1b;
            background: white;
            resize: vertical;
        }

        .form-textarea:focus {
            outline: 3px solid #2491ff;
            outline-offset: 0;
        }

        /* Spoke screen hidden by default */
        .spoke-screen {
            display: none;
        }

        .spoke-screen.active {
            display: block;
        }

        /* ============================================
           CONFIG HEADER
           ============================================ */
        .config-header {
            background: #1b1b1b;
            color: white;
            padding: 12px 16px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .config-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 12px;
            max-width: 640px;
            margin: 0 auto;
        }

        .config-label {
            font-size: 13px;
            color: #a0a0a0;
        }

        .config-controls {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .config-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .config-toggle {
            display: flex;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
        }

        .config-toggle button {
            padding: 6px 12px;
            font-size: 13px;
            font-weight: 600;
            border: none;
            background: transparent;
            color: #a0a0a0;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .config-toggle button.active {
            background: #005ea2;
            color: white;
        }

        .config-select {
            padding: 6px 10px;
            font-size: 13px;
            border: 1px solid #555;
            border-radius: 4px;
            background: #333;
            color: white;
            cursor: pointer;
        }

        .flow-label {
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 700;
            background: #005ea2;
            color: white;
        }

        /* Reduced motion */
        @media (prefers-reduced-motion: reduce) {
            * {
                transition: none !important;
                animation: none !important;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 24px;
            }

            .hub-title {
                font-size: 24px;
            }

            .config-row {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body class="nav-step-indicator">

<!-- Prototype config header -->
<div class="config-header">
    <div class="config-row">
        <div style="display: flex; align-items: center; gap: 12px;">
            <span class="config-label">Prototype</span>
            <span class="flow-label">Spoke Navigation</span>
        </div>
        <div class="config-controls">
            <div class="config-group">
                <span class="config-label">Nav:</span>
                <div class="config-toggle">
                    <button id="toggleStepIndicator" class="active" onclick="setNavMode('step-indicator')">Step indicator</button>
                    <button id="toggleMinimal" onclick="setNavMode('minimal')">Minimal</button>
                </div>
            </div>
            <div class="config-group">
                <span class="config-label">Months:</span>
                <select class="config-select" id="monthsSelect" onchange="setMonthCount(parseInt(this.value))">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3" selected>3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                </select>
            </div>
        </div>
    </div>
</div>

<!-- ============================================
     HUB VIEW
     ============================================ -->
<div class="view active" id="hubView">
    <!-- Government Banner -->
    <div class="gov-banner">
        <div class="gov-banner-inner">
            <p class="gov-banner-text">A website in partnership with example state</p>
        </div>
    </div>

    <!-- EMMY Header -->
    <div class="emmy-header">
        <div class="emmy-header-inner">
            <div class="emmy-header-title">Eligibility Made Easy | State</div>
            <button class="emmy-header-menu">MENU</button>
        </div>
    </div>

    <div class="container">
        <div class="hub-content">
            <!-- Success Banner (hidden by default) -->
            <div class="success-banner" id="successBanner"></div>

            <h1 class="hub-title">Add activities to your Community Engagement report</h1>
            <p class="hub-period"><strong>Reporting period:</strong> any 3 months between July &ndash; December 2026</p>

            <!-- Progress Section -->
            <div class="progress-section" id="progressSection">
                <h2>Your progress</h2>
                <p class="progress-section-desc">We calculate your community engagement from the activities you add to your report.</p>
                <div class="months-completed-counter" id="monthsCompletedCounter">0 / 3 months completed</div>
                <div class="month-progress-list" id="monthProgressList">
                    <!-- Rendered by JS -->
                </div>
                <button class="submit-cta">Review and submit</button>
            </div>

            <!-- Activity Categories -->
            <div id="activityCategories">
                <!-- Rendered by JS -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="site-footer">
        <div class="site-footer-inner">
            <div class="site-footer-title">Eligibility Made Easy</div>
            <button class="site-footer-button">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/></svg>
                Share feedback
            </button>
        </div>
    </div>
</div>

<!-- ============================================
     SPOKE VIEW
     ============================================ -->
<div class="view" id="spokeView">
    <!-- Government Banner -->
    <div class="gov-banner">
        <div class="gov-banner-inner">
            <p class="gov-banner-text">A website in partnership with example state</p>
        </div>
    </div>

    <!-- EMMY Header -->
    <div class="emmy-header">
        <div class="emmy-header-inner">
            <div class="emmy-header-title">Eligibility Made Easy | State</div>
            <button class="emmy-header-menu">MENU</button>
        </div>
    </div>

    <!-- Spoke Chrome (sticky) -->
    <div class="spoke-chrome" id="spokeChrome">
        <!-- Row 1: Flow label + Exit (always visible) -->
        <div class="spoke-chrome-row1">
            <span class="spoke-flow-label" id="spokeFlowLabel">Add employment</span>
            <button class="spoke-exit-link" onclick="handleExit()">Exit &times;</button>
        </div>

        <!-- Step indicator (Option 1 only — hidden when nav-minimal) -->
        <div class="spoke-step-indicator" id="spokeStepIndicator">
            <div class="spoke-step-bar" id="spokeStepBar">
                <div class="spoke-step-segment"></div>
                <div class="spoke-step-segment"></div>
                <div class="spoke-step-segment"></div>
                <div class="spoke-step-segment"></div>
            </div>
            <div class="spoke-step-counter" id="spokeStepCounter">
                <div class="spoke-step-circle" id="spokeStepNumber">1</div>
                <span class="spoke-step-text">of 4</span>
                <span class="spoke-step-phase" id="spokeStepPhase">Organization info</span>
            </div>
        </div>
    </div>

    <!-- Exit Warning -->
    <div class="container">
        <div class="exit-warning" id="exitWarning">
            <h3>Leave without saving?</h3>
            <p>The information you've entered won't be saved.</p>
            <div class="exit-warning-actions">
                <button class="exit-warning-leave" onclick="confirmExit()">Leave and discard</button>
                <button class="exit-warning-stay" onclick="dismissExit()">Keep working</button>
            </div>
        </div>
    </div>

    <!-- Spoke Screen Content -->
    <div class="container">
        <div class="spoke-content" id="spokeContent">
            <!-- Rendered by JS -->
        </div>
    </div>

    <!-- Footer -->
    <div class="site-footer" id="spokeFooter">
        <div class="site-footer-inner">
            <div class="site-footer-title">Eligibility Made Easy</div>
            <button class="site-footer-button">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/></svg>
                Share feedback
            </button>
        </div>
    </div>
</div>


<script>
    // ============================================
    // SVG ICONS
    // ============================================

    var ICONS = {
        arrowBack: '<svg viewBox="0 0 24 24" width="12" height="12" fill="currentColor"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>',
        addCircle: '<svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/></svg>'
    };

    // ============================================
    // CONFIG STATE
    // ============================================

    var navMode = 'step-indicator';
    var monthCount = 3;

    function setNavMode(mode) {
        navMode = mode;
        document.body.classList.remove('nav-step-indicator', 'nav-minimal');
        document.body.classList.add('nav-' + mode);
        document.getElementById('toggleStepIndicator').classList.toggle('active', mode === 'step-indicator');
        document.getElementById('toggleMinimal').classList.toggle('active', mode === 'minimal');
        if (document.getElementById('spokeView').classList.contains('active')) {
            updateSpokeChrome();
        }
    }

    function setMonthCount(n) {
        monthCount = n;
        document.getElementById('monthsSelect').value = n;
        // If in a spoke, re-initialize months and restart from org info
        if (document.getElementById('spokeView').classList.contains('active') && currentSpokeData) {
            spokeFormData.months = buildBlankMonths();
            currentSpokeStep = 0;
            currentMonthSub = 0;
            renderSpokeScreen();
        }
    }

    // ============================================
    // DATA
    // ============================================

    var MONTHS = [
        { key: 'jul', label: 'July' },
        { key: 'aug', label: 'August' },
        { key: 'sep', label: 'September' },
        { key: 'oct', label: 'October' },
        { key: 'nov', label: 'November' },
        { key: 'dec', label: 'December' }
    ];

    function getSpokeMonths() {
        return MONTHS.slice(0, monthCount);
    }

    function buildBlankMonths() {
        var months = {};
        getSpokeMonths().forEach(function(m) {
            months[m.key] = { noData: false, income: '', hours: '' };
        });
        return months;
    }

    var STEP_PHASES = ['Organization info', 'Monthly details', 'Supporting documents', 'Review'];

    var EMPLOYMENT_DATA = {
        type: 'employment',
        flowLabel: 'Add employment',
        orgName: 'Gainesville Wrecking',
        orgAddress: '942 W Harlan Ave, Gainesville, FL',
        orgEmail: 'donny@gainesvillewrecking.net',
        orgCoordinator: '',
        orgCoordinatorEmail: ''
    };

    var COMMUNITY_SERVICE_DATA = {
        type: 'community-service',
        flowLabel: 'Community service',
        orgName: 'Habitat for Humanity \u2014 Alachua County',
        orgAddress: '2630 NW 41st St, Gainesville, FL',
        orgEmail: '',
        orgCoordinator: 'Maria Santos',
        orgCoordinatorEmail: 'maria@alachuahabitat.org'
    };

    var CATEGORIES = [
        { key: 'employment', label: 'Employment', emptyText: 'No employment added', enabled: true },
        { key: 'education', label: 'Education', emptyText: 'No education added', enabled: false },
        { key: 'community-service', label: 'Community service', emptyText: 'No community service added', enabled: true },
        { key: 'work-programs', label: 'Work programs', emptyText: 'No work programs added', enabled: false }
    ];

    // ============================================
    // STATE
    // ============================================

    var completedActivities = {};
    var currentSpokeData = null;
    var currentSpokeStep = 0;
    var currentMonthSub = 0;
    var spokeFormData = {};

    // ============================================
    // HUB RENDERING
    // ============================================

    function renderHub() {
        renderProgressBars();
        renderCategories();
    }

    function renderProgressBars() {
        var list = document.getElementById('monthProgressList');
        var html = '';
        MONTHS.forEach(function(month) {
            html += '<div class="month-progress-row">' +
                '<div class="month-progress-header">' +
                '<span class="month-progress-label">' + month.label + '</span>' +
                '<span class="month-progress-hours">0 / 80 hours</span></div>' +
                '<div class="month-progress-bar">' +
                '<div class="month-progress-bar-fill" style="width: 0%;"></div></div></div>';
        });
        list.innerHTML = html;
        document.getElementById('monthsCompletedCounter').textContent = '0 / 3 months completed';
    }

    function renderCategories() {
        var container = document.getElementById('activityCategories');
        var html = '';
        CATEGORIES.forEach(function(cat) {
            var activity = completedActivities[cat.key];
            var hasActivity = !!activity;
            html += '<div class="category-section"><div class="category-header">';
            html += '<h2 class="category-title">' + cat.label + '</h2>';
            if (cat.enabled && !hasActivity) {
                html += '<button class="category-add-btn" onclick="enterSpoke(\'' + cat.key + '\')">' + ICONS.addCircle + ' Add</button>';
            } else if (!cat.enabled) {
                html += '<button class="category-add-btn" disabled>' + ICONS.addCircle + ' Add</button>';
            }
            html += '</div>';
            html += hasActivity ? renderActivityCard(activity, cat.key) : '<div class="category-empty">' + cat.emptyText + '</div>';
            html += '</div>';
        });
        container.innerHTML = html;
    }

    function renderActivityCard(activity, categoryKey) {
        var stats = '<div class="activity-stat"><span class="activity-stat-label">Months reported</span>' +
            '<span class="activity-stat-value">' + activity.monthsReported + '</span></div>' +
            '<div class="activity-stat"><span class="activity-stat-label">Total hours</span>' +
            '<span class="activity-stat-value">' + activity.totalHours + '</span></div>';
        if (categoryKey === 'employment') {
            stats += '<div class="activity-stat"><span class="activity-stat-label">Total gross income</span>' +
                '<span class="activity-stat-value">$' + activity.totalIncome + '</span></div>';
        }
        return '<div class="activity-card"><div class="activity-card-header">' +
            '<div class="activity-card-name">' + activity.orgName + '</div>' +
            '<button class="activity-card-link">View details</button></div>' +
            '<div class="activity-card-body"><div class="activity-card-stats">' + stats + '</div></div></div>';
    }

    function showSuccessBanner(orgName) {
        var banner = document.getElementById('successBanner');
        banner.textContent = '\u2713 ' + orgName + ' added to your report';
        banner.style.display = 'block';
        setTimeout(function() { banner.style.display = 'none'; }, 4000);
    }

    // ============================================
    // SPOKE ENTRY
    // ============================================

    function enterSpoke(categoryKey) {
        if (categoryKey === 'employment') {
            currentSpokeData = JSON.parse(JSON.stringify(EMPLOYMENT_DATA));
        } else if (categoryKey === 'community-service') {
            currentSpokeData = JSON.parse(JSON.stringify(COMMUNITY_SERVICE_DATA));
        } else {
            return;
        }

        spokeFormData = {
            orgName: currentSpokeData.orgName,
            orgAddress: currentSpokeData.orgAddress,
            orgEmail: currentSpokeData.orgEmail,
            orgCoordinator: currentSpokeData.orgCoordinator || '',
            orgCoordinatorEmail: currentSpokeData.orgCoordinatorEmail || '',
            months: buildBlankMonths()
        };

        currentSpokeStep = 0;
        currentMonthSub = 0;

        document.getElementById('hubView').classList.remove('active');
        document.getElementById('spokeView').classList.add('active');
        document.getElementById('exitWarning').classList.remove('visible');
        document.getElementById('spokeFlowLabel').textContent = currentSpokeData.flowLabel;

        renderSpokeScreen();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ============================================
    // SPOKE CHROME UPDATE
    // ============================================

    function updateSpokeChrome() {
        var visualStep = currentSpokeStep + 1;
        var segments = document.querySelectorAll('#spokeStepBar .spoke-step-segment');
        segments.forEach(function(seg, i) {
            seg.classList.toggle('completed', i < visualStep);
        });
        document.getElementById('spokeStepNumber').textContent = visualStep;
        document.getElementById('spokeStepPhase').textContent = STEP_PHASES[currentSpokeStep];
    }

    // ============================================
    // SPOKE SCREEN RENDERING
    // ============================================

    function renderSpokeScreen() {
        updateSpokeChrome();
        var content = document.getElementById('spokeContent');
        var html = '<button class="back-link" onclick="spokeBack()">' + ICONS.arrowBack + ' Back</button>';

        if (currentSpokeStep === 0) {
            html += renderOrgInfoScreen();
        } else if (currentSpokeStep === 1) {
            html += renderMonthlyScreen();
        } else if (currentSpokeStep === 2) {
            html += renderUploadScreen();
        } else if (currentSpokeStep === 3) {
            html += renderReviewScreen();
        }

        content.innerHTML = html;
        if (currentSpokeStep === 1) initMonthScreen();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Step 1: Organization Info
    function renderOrgInfoScreen() {
        var isEmployment = currentSpokeData.type === 'employment';
        var title, introText, fieldsHtml;

        if (isEmployment) {
            title = 'Tell us about your employer or business';
            introText = 'Enter as much information as you can. This will help <Agency initials> get in touch with your employer, if needed.';
            fieldsHtml = '<div class="form-group">' +
                '<label class="form-label" for="orgNameInput">Employer or business name</label>' +
                '<p class="form-hint">If you work for yourself, enter your name</p>' +
                '<input type="text" class="form-input" id="orgNameInput" value="' + escapeHtml(spokeFormData.orgName) + '"></div>' +
                '<div class="form-group">' +
                '<label class="form-label" for="orgAddressInput">Employer or business address</label>' +
                '<p class="form-hint">If you work for yourself, enter your address</p>' +
                '<input type="text" class="form-input" id="orgAddressInput" value="' + escapeHtml(spokeFormData.orgAddress) + '"></div>' +
                '<div class="form-group">' +
                '<label class="form-label" for="orgEmailInput">Employer or business contact email</label>' +
                '<input type="email" class="form-input" id="orgEmailInput" value="' + escapeHtml(spokeFormData.orgEmail) + '"></div>';
        } else {
            title = 'Tell us about your community service organization';
            introText = 'Enter as much information as you can. This will help <Agency initials> get in touch with your community service organization, if needed.';
            fieldsHtml = '<h2 style="font-family: Public Sans, sans-serif; font-size: 20px; font-weight: 700; margin-bottom: 16px; margin-top: 8px;">Organization information</h2>' +
                '<div class="form-group">' +
                '<label class="form-label" for="orgNameInput">Organization name</label>' +
                '<p class="form-hint">Enter the full and official name</p>' +
                '<input type="text" class="form-input" id="orgNameInput" value="' + escapeHtml(spokeFormData.orgName) + '"></div>' +
                '<div class="form-group">' +
                '<label class="form-label" for="orgAddressInput">Street address</label>' +
                '<input type="text" class="form-input" id="orgAddressInput" value="' + escapeHtml(spokeFormData.orgAddress) + '"></div>' +
                '<h2 style="font-family: Public Sans, sans-serif; font-size: 20px; font-weight: 700; margin-bottom: 16px; margin-top: 32px;">Coordinator information</h2>' +
                '<div class="form-group">' +
                '<label class="form-label" for="orgCoordinatorInput">Coordinator\'s name</label>' +
                '<p class="form-hint">The person you worked most closely with or reported to</p>' +
                '<input type="text" class="form-input" id="orgCoordinatorInput" value="' + escapeHtml(spokeFormData.orgCoordinator) + '"></div>' +
                '<div class="form-group">' +
                '<label class="form-label" for="orgCoordinatorEmailInput">Coordinator\'s email</label>' +
                '<input type="email" class="form-input" id="orgCoordinatorEmailInput" value="' + escapeHtml(spokeFormData.orgCoordinatorEmail) + '"></div>';
        }

        return '<h1>' + title + '</h1>' +
            '<p class="form-intro">' + introText + '</p>' +
            fieldsHtml +
            '<button class="btn-primary" onclick="saveOrgAndContinue()">Continue</button>';
    }

    // Step 2: Monthly Details
    function renderMonthlyScreen() {
        var spokeMonths = getSpokeMonths();
        var monthObj = spokeMonths[currentMonthSub];
        var monthKey = monthObj.key;
        var monthLabel = monthObj.label;
        var monthData = spokeFormData.months[monthKey];
        var isEmployment = currentSpokeData.type === 'employment';
        var orgName = spokeFormData.orgName;

        var title = isEmployment
            ? 'Enter the hours and income you worked at ' + escapeHtml(orgName) + ' in ' + monthLabel
            : 'Add your ' + monthLabel + ' community service hours with ' + escapeHtml(orgName);

        var noDataLabel = isEmployment
            ? 'No ' + monthLabel + ' income'
            : 'No community service hours with ' + escapeHtml(orgName) + ' in ' + monthLabel;

        var isChecked = monthData.noData;
        var checkedClass = isChecked ? 'checked' : '';
        var checkedAttr = isChecked ? 'checked' : '';

        var fieldsHtml = '';
        if (isEmployment) {
            fieldsHtml = '<div id="monthFields" style="' + (isChecked ? 'display:none' : '') + '">' +
                '<div class="form-group"><label class="form-label" for="incomeInput">Gross income</label>' +
                '<p class="form-hint">How much you made before taxes</p>' +
                '<div class="input-prefix-wrapper"><span class="input-prefix">$</span>' +
                '<input type="number" class="form-input" id="incomeInput" value="' + escapeHtml(monthData.income) + '" min="0" step="0.01"></div></div>' +
                '<div class="form-group"><label class="form-label" for="hoursInput">Total hours worked</label>' +
                '<input type="number" class="form-input" id="hoursInput" value="' + escapeHtml(monthData.hours) + '" min="0" step="1"></div></div>';
        } else {
            fieldsHtml = '<div id="monthFields" style="' + (isChecked ? 'display:none' : '') + '">' +
                '<div class="form-group"><label class="form-label" for="hoursInput">' + monthLabel + ' community service hours</label>' +
                '<input type="number" class="form-input" id="hoursInput" value="' + escapeHtml(monthData.hours) + '" min="0" step="1"></div></div>';
        }

        return '<div class="month-sub-counter">Month ' + (currentMonthSub + 1) + ' / ' + spokeMonths.length + '</div>' +
            '<h1>' + title + '</h1>' +
            '<div class="tile-checkbox ' + checkedClass + '" id="noDataTile" onclick="toggleNoData()">' +
            '<input type="checkbox" id="noDataCheck" ' + checkedAttr + '>' +
            '<label for="noDataCheck">' + noDataLabel + '</label></div>' +
            fieldsHtml +
            '<button class="btn-primary" onclick="saveMonthAndContinue()">Continue</button>';
    }

    function initMonthScreen() {
        var spokeMonths = getSpokeMonths();
        var monthKey = spokeMonths[currentMonthSub].key;
        var monthData = spokeFormData.months[monthKey];
        var tile = document.getElementById('noDataTile');
        var check = document.getElementById('noDataCheck');
        if (tile && check) {
            check.checked = monthData.noData;
            tile.classList.toggle('checked', monthData.noData);
        }
    }

    function toggleNoData() {
        var spokeMonths = getSpokeMonths();
        var monthKey = spokeMonths[currentMonthSub].key;
        var monthData = spokeFormData.months[monthKey];
        monthData.noData = !monthData.noData;

        var tile = document.getElementById('noDataTile');
        var check = document.getElementById('noDataCheck');
        var fields = document.getElementById('monthFields');
        if (tile && check && fields) {
            check.checked = monthData.noData;
            tile.classList.toggle('checked', monthData.noData);
            fields.style.display = monthData.noData ? 'none' : '';
        }
        if (monthData.noData) {
            monthData.income = '';
            monthData.hours = '';
        }
    }

    // Step 3: Supporting Documents
    function renderUploadScreen() {
        var orgName = spokeFormData.orgName;
        var isEmployment = currentSpokeData.type === 'employment';
        var spokeMonths = getSpokeMonths();

        var monthsWithData = spokeMonths.filter(function(m) {
            return !spokeFormData.months[m.key].noData;
        });

        var monthSummaryHtml = '';
        if (monthsWithData.length > 0) {
            monthSummaryHtml = '<ul style="margin: 0 0 0 20px; padding: 0;">';
            monthsWithData.forEach(function(m) {
                var md = spokeFormData.months[m.key];
                monthSummaryHtml += '<li><strong>' + m.label + ' 2026</strong> (' + (md.hours || '0') + ' hours)</li>';
            });
            monthSummaryHtml += '</ul>';
        }

        var instructionText = monthsWithData.length > 0
            ? 'Upload documents that verify the information you entered for:'
            : 'You reported no data for any months. You can still upload documents if you have them.';
        if (monthsWithData.length === 0) monthSummaryHtml = '';

        var suggestedDocs = isEmployment
            ? '<ul><li>Pay stubs</li><li>Employer letter</li><li>Bank statements showing deposits</li></ul>'
            : '<ul><li>Volunteer log or timesheet</li><li>Letter from coordinator</li><li>Organization attendance records</li></ul>';

        return '<h1>Upload supporting documents for ' + escapeHtml(orgName) + '</h1>' +
            '<p class="upload-instructions">' + instructionText + '</p>' +
            monthSummaryHtml +
            '<div class="form-group" style="margin-top: 24px;">' +
            '<label class="form-label">Documents</label>' +
            '<p class="form-hint">Select PDF, PNG, JPG, or HEIC files</p>' +
            '<div class="file-upload-area" onclick="simulateUpload()">' +
            '<div class="file-upload-icon"><svg viewBox="0 0 24 24" fill="#71767a" width="32" height="32"><path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"/></svg></div>' +
            '<p>Drag files here or <a href="#" onclick="event.preventDefault()">choose from folder</a></p></div></div>' +
            '<div class="suggested-docs">' +
            '<button class="suggested-docs-toggle" id="suggestedDocsToggle" onclick="toggleSuggestedDocs()">' +
            'Suggested documents <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg></button>' +
            '<div class="suggested-docs-content" id="suggestedDocsContent">' + suggestedDocs + '</div></div>' +
            '<button class="btn-primary" onclick="continueToReview()">Continue to review</button>';
    }

    function toggleSuggestedDocs() {
        document.getElementById('suggestedDocsContent').classList.toggle('open');
        document.getElementById('suggestedDocsToggle').classList.toggle('open');
    }

    function simulateUpload() {}

    // Step 4: Review
    function renderReviewScreen() {
        var isEmployment = currentSpokeData.type === 'employment';
        var orgName = spokeFormData.orgName;
        var activityLabel = isEmployment ? 'employment' : 'community service';
        var spokeMonths = getSpokeMonths();

        var introText = 'Review all the information you\'ve added for ' + escapeHtml(orgName) +
            ' before adding it to your Community Engagement Report.';

        // Org info
        var orgInfoRows = '';
        if (isEmployment) {
            orgInfoRows = '<div class="review-row"><div class="review-label">Employer name</div><div class="review-value">' + escapeHtml(spokeFormData.orgName) + '</div></div>' +
                '<div class="review-row"><div class="review-label">Address</div><div class="review-value">' + escapeHtml(spokeFormData.orgAddress) + '</div></div>' +
                '<div class="review-row"><div class="review-label">Contact email</div><div class="review-value">' + escapeHtml(spokeFormData.orgEmail) + '</div></div>';
        } else {
            orgInfoRows = '<div class="review-row"><div class="review-label">Name</div><div class="review-value">' + escapeHtml(spokeFormData.orgName) + '</div></div>' +
                '<div class="review-row"><div class="review-label">Address</div><div class="review-value">' + escapeHtml(spokeFormData.orgAddress) + '</div></div>' +
                '<div class="review-row"><div class="review-label">Coordinator\'s name</div><div class="review-value">' + escapeHtml(spokeFormData.orgCoordinator) + '</div></div>' +
                '<div class="review-row"><div class="review-label">Coordinator\'s email</div><div class="review-value">' + escapeHtml(spokeFormData.orgCoordinatorEmail) + '</div></div>';
        }

        // Monthly details
        var monthRows = '';
        spokeMonths.forEach(function(m, idx) {
            var md = spokeFormData.months[m.key];
            if (md.noData) {
                monthRows += '<div class="review-month-block"><div class="review-month-header">' +
                    '<span class="review-month-name no-data">' + m.label + '</span>' +
                    '<button class="edit-link" onclick="editMonthFromReview(' + idx + ')">Edit</button></div>' +
                    '<div class="review-month-detail"><span class="review-month-detail-label">' +
                    (isEmployment ? 'No income reported' : 'No hours reported') + '</span></div></div>';
            } else if (isEmployment) {
                monthRows += '<div class="review-month-block"><div class="review-month-header">' +
                    '<span class="review-month-name">' + m.label + '</span>' +
                    '<button class="edit-link" onclick="editMonthFromReview(' + idx + ')">Edit</button></div>' +
                    '<div class="review-month-detail"><span class="review-month-detail-label">Gross income</span>' +
                    '<span class="review-month-detail-value">$' + (md.income || '0') + '</span></div>' +
                    '<div class="review-month-detail"><span class="review-month-detail-label">Total hours worked</span>' +
                    '<span class="review-month-detail-value">' + (md.hours || '0') + '</span></div></div>';
            } else {
                monthRows += '<div class="review-month-block"><div class="review-month-header">' +
                    '<span class="review-month-name">' + m.label + '</span>' +
                    '<button class="edit-link" onclick="editMonthFromReview(' + idx + ')">Edit</button></div>' +
                    '<div class="review-month-detail"><span class="review-month-detail-label">Community service hours</span>' +
                    '<span class="review-month-detail-value">' + (md.hours || '0') + '</span></div></div>';
            }
        });

        var docsContent = '<div class="review-row"><div class="review-value" style="color: #71767a;">No documents uploaded</div></div>';

        return '<h1>Review your ' + activityLabel + ' information for ' + escapeHtml(orgName) + '</h1>' +
            '<p class="review-intro">' + introText + '</p>' +
            '<div class="review-section"><div class="review-section-header-row"><span>' + (isEmployment ? 'Employer information' : 'Organization information') + '</span>' +
            '<button class="change-link" onclick="changeFromReview(0)">Change</button></div>' + orgInfoRows + '</div>' +
            '<div class="review-section"><div class="review-section-header">' + (isEmployment ? 'Hours and income' : 'Community service hours') + '</div>' + monthRows + '</div>' +
            '<div class="review-section"><div class="review-section-header-row"><span>Supporting documents</span>' +
            '<button class="change-link" onclick="changeFromReview(2)">Change</button></div>' + docsContent + '</div>' +
            '<div class="form-group" style="margin-top: 32px;"><label class="form-label">Additional comments (optional)</label>' +
            '<p class="form-hint">Share any comments or additional information that you\'d like <Agency name> to know.</p>' +
            '<textarea class="form-textarea" placeholder=""></textarea></div>' +
            '<button class="btn-primary" onclick="saveAndAddToReport()">Save and add to my report</button>';
    }

    // ============================================
    // SPOKE NAVIGATION
    // ============================================

    function saveOrgAndContinue() {
        var nameEl = document.getElementById('orgNameInput');
        var addrEl = document.getElementById('orgAddressInput');
        var emailEl = document.getElementById('orgEmailInput');
        var coordEl = document.getElementById('orgCoordinatorInput');
        var coordEmailEl = document.getElementById('orgCoordinatorEmailInput');
        if (nameEl) spokeFormData.orgName = nameEl.value;
        if (addrEl) spokeFormData.orgAddress = addrEl.value;
        if (emailEl) spokeFormData.orgEmail = emailEl.value;
        if (coordEl) spokeFormData.orgCoordinator = coordEl.value;
        if (coordEmailEl) spokeFormData.orgCoordinatorEmail = coordEmailEl.value;

        if (returnToReview) {
            returnToReview = false;
            currentSpokeStep = 3;
            renderSpokeScreen();
            return;
        }
        currentSpokeStep = 1;
        currentMonthSub = 0;
        renderSpokeScreen();
    }

    function saveMonthAndContinue() {
        var spokeMonths = getSpokeMonths();
        var monthKey = spokeMonths[currentMonthSub].key;
        var md = spokeFormData.months[monthKey];
        if (!md.noData) {
            var incomeEl = document.getElementById('incomeInput');
            var hoursEl = document.getElementById('hoursInput');
            if (incomeEl) md.income = incomeEl.value;
            if (hoursEl) md.hours = hoursEl.value;
        }

        if (returnToReview) {
            returnToReview = false;
            currentSpokeStep = 3;
            renderSpokeScreen();
            return;
        }
        if (currentMonthSub < spokeMonths.length - 1) {
            currentMonthSub++;
            renderSpokeScreen();
        } else {
            currentSpokeStep = 2;
            renderSpokeScreen();
        }
    }

    function continueToReview() {
        returnToReview = false;
        currentSpokeStep = 3;
        renderSpokeScreen();
    }

    // Edit from review — jump to a specific screen, then return to review on save
    var returnToReview = false;

    function editMonthFromReview(monthIdx) {
        returnToReview = true;
        currentSpokeStep = 1;
        currentMonthSub = monthIdx;
        renderSpokeScreen();
    }

    function changeFromReview(step) {
        returnToReview = true;
        currentSpokeStep = step;
        renderSpokeScreen();
    }

    function spokeBack() {
        saveCurrentFormState();
        if (returnToReview) {
            returnToReview = false;
            currentSpokeStep = 3;
            renderSpokeScreen();
            return;
        }
        if (currentSpokeStep === 0) {
            handleExit();
            return;
        } else if (currentSpokeStep === 1) {
            if (currentMonthSub === 0) {
                currentSpokeStep = 0;
            } else {
                currentMonthSub--;
            }
        } else if (currentSpokeStep === 2) {
            currentSpokeStep = 1;
            currentMonthSub = getSpokeMonths().length - 1;
        } else if (currentSpokeStep === 3) {
            currentSpokeStep = 2;
        }
        renderSpokeScreen();
    }

    function saveCurrentFormState() {
        if (currentSpokeStep === 0) {
            var nameEl = document.getElementById('orgNameInput');
            var addrEl = document.getElementById('orgAddressInput');
            var emailEl = document.getElementById('orgEmailInput');
            var coordEl = document.getElementById('orgCoordinatorInput');
            var coordEmailEl = document.getElementById('orgCoordinatorEmailInput');
            if (nameEl) spokeFormData.orgName = nameEl.value;
            if (addrEl) spokeFormData.orgAddress = addrEl.value;
            if (emailEl) spokeFormData.orgEmail = emailEl.value;
            if (coordEl) spokeFormData.orgCoordinator = coordEl.value;
            if (coordEmailEl) spokeFormData.orgCoordinatorEmail = coordEmailEl.value;
        } else if (currentSpokeStep === 1) {
            var spokeMonths = getSpokeMonths();
            var monthKey = spokeMonths[currentMonthSub].key;
            var md = spokeFormData.months[monthKey];
            if (!md.noData) {
                var incomeEl = document.getElementById('incomeInput');
                var hoursEl = document.getElementById('hoursInput');
                if (incomeEl) md.income = incomeEl.value;
                if (hoursEl) md.hours = hoursEl.value;
            }
        }
    }

    // ============================================
    // EXIT HANDLING
    // ============================================

    function handleExit() {
        document.getElementById('exitWarning').classList.add('visible');
    }

    function dismissExit() {
        document.getElementById('exitWarning').classList.remove('visible');
    }

    function confirmExit() {
        document.getElementById('exitWarning').classList.remove('visible');
        currentSpokeData = null;
        spokeFormData = {};
        document.getElementById('spokeView').classList.remove('active');
        document.getElementById('hubView').classList.add('active');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ============================================
    // SAVE AND RETURN TO HUB
    // ============================================

    function saveAndAddToReport() {
        var isEmployment = currentSpokeData.type === 'employment';
        var categoryKey = currentSpokeData.type;
        var spokeMonths = getSpokeMonths();
        var totalHours = 0, totalIncome = 0, monthsReported = 0;

        spokeMonths.forEach(function(m) {
            var md = spokeFormData.months[m.key];
            if (!md.noData) {
                monthsReported++;
                totalHours += parseInt(md.hours) || 0;
                if (isEmployment) totalIncome += parseFloat(md.income) || 0;
            }
        });

        completedActivities[categoryKey] = {
            orgName: spokeFormData.orgName,
            monthsReported: monthsReported,
            totalHours: totalHours,
            totalIncome: totalIncome
        };

        currentSpokeData = null;
        spokeFormData = {};
        document.getElementById('spokeView').classList.remove('active');
        document.getElementById('hubView').classList.add('active');
        renderHub();
        showSuccessBanner(completedActivities[categoryKey].orgName);
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ============================================
    // UTILITIES
    // ============================================

    function escapeHtml(str) {
        if (!str) return '';
        return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
    }

    // ============================================
    // INIT
    // ============================================

    renderHub();
</script>
</body>
</html>
